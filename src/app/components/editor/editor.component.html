<!-- <div class="avatar-bar">

    <div
      class="avatar"
      *ngFor="let user of currentlyViewingUsers; let i = index"
      [style.zIndex]="currentlyViewingUsers.length - i"
      [style.background]="getColor(user.userId)"
      [title]="user.userName"
    >
      {{ getInitials(user.userName) }}
    </div>
  </div>
  <div class="editor-wrapper">
    <input type="text" [(ngModel)]="title" placeholder="Enter document title" class="title-input" />

    <quill-editor [styles]="{ direction: 'ltr', textAlign: 'left' }"  [(ngModel)]="content" (onEditorCreated)="onEditorCreated($event)"></quill-editor>
    <div class="button-group">
      <button (click)="updateDocument()" class="save-btn">Update</button>
      <button (click)="saveDocument()" class="save-btn">Save as a new copy</button>
    </div>
    <div *ngIf="loading" class="spinner-overlay">
      <div class="spinner"></div>
    </div>
    
    <div class="cursor-overlay" #cursorOverlay></div>
  </div> -->
  
 <!-- <div class="editor-container">
    <input type="text" [(ngModel)]="title" placeholder="Enter document title" class="title-input" />

    <quill-editor [styles]="{ direction: 'ltr', textAlign: 'left' }"  [(ngModel)]="content" (onEditorCreated)="onEditorCreated($event)"></quill-editor>
    <div class="button-group">
      <button (click)="updateDocument()" class="save-btn">Update</button>
      <button (click)="saveDocument()" class="save-btn">Save as a new copy</button>
    </div>
    <div *ngIf="loading" class="spinner-overlay">
      <div class="spinner"></div>
    </div>
</div>  -->


<div class="editor-container" #editorContainer>
  <div class="avatar-bar">
    <div
      class="avatar"
      *ngFor="let user of currentlyViewingUsers; let i = index"
      [style.zIndex]="currentlyViewingUsers.length - i"
      [ngStyle]="{
        background: profileImageUrls[user.userId] ? 'transparent' : getColor(user.userId)
      }"
      [title]="user.userName"
    >
      <ng-container *ngIf="profileImageUrls[user.userId]; else initialsAvatar">
        <img
          [src]="profileImageUrls[user.userId]"
          alt="{{ user.userName }}"
          class="avatar-img"
        />
      </ng-container>
      <ng-template #initialsAvatar>
        {{ getInitials(user.userName) }}
      </ng-template>
    </div>
  </div>

  
  
  <!-- <div class="avatar-bar">
    <div
      class="avatar"
      *ngFor="let user of currentlyViewingUsers; let i = index"
      [style.zIndex]="currentlyViewingUsers.length - i"
      [title]="user.userName"
    >
      <img
        [src]="'/assets/avatars/' + user.userId + '.png'"
        [alt]="user.userName + ' avatar'"
      />
    </div>
  </div> -->
  
  <!-- Document title -->
  <input
    type="text"
    [(ngModel)]="title"
    placeholder="Enter document title"
    class="title-input"
  />

  <!-- Quill editor -->
  <div class="editor-wrapper">
    <quill-editor
      [(ngModel)]="content"
      (onEditorCreated)="onEditorCreated($event)"
      
      (mouseup)="onCursorMove($event)"
      [styles]="{ direction: 'ltr', textAlign: 'left' }"
    ></quill-editor>

    
    <!-- Floating cursors (avatars) for other users -->
    <div *ngFor="let cursor of liveCursorsofUsers">
      <!-- Cursor pointer image -->
      <img
        class="cursor-pointer"
        src="/assets/cursor.png"
        [ngStyle]="{
          top: cursor.y + 'px',
          left: cursor.x + 'px',
          
        }"
        alt="cursor"
      />
    
      <!-- Avatar (profile pic or initials) -->
      <div
        class="cursor-avatar"
        [ngStyle]="{
          top: cursor.y + 'px',
          left: cursor.x + 'px',
          background: profileImageUrls[cursor.userId] ? 'transparent' : getColor(cursor.userId)
        }"
        [title]="this.userNameDict[cursor.userId]"
      >
        <ng-container *ngIf="profileImageUrls[cursor.userId]; else initialsCursor">
          <img
            [src]="profileImageUrls[cursor.userId]"
            alt="{{ this.userNameDict[cursor.userId] }}"
            class="cursor-avatar-img"
          />
        </ng-container>
    
        <ng-template #initialsCursor>
          {{ getInitialsFromUserId(cursor.userId) }}
        </ng-template>
      </div>
    </div>
    

  <!-- Buttons -->
  <div class="button-group">
    <button (click)="updateDocument()" class="save-btn">Update</button>
    <button (click)="saveDocument()" class="save-btn">Save as a new copy</button>
    <button (click)="logout()" class="logout-btn">Logout</button>
  </div>

  <!-- Loading spinner -->
  <div *ngIf="loading" class="spinner-overlay">
    <div class="spinner"></div>
  </div>
</div>
</div>